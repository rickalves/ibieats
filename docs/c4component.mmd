C4Component
title Orders Service - Component Diagram (Boundary + SAGA)

System_Boundary(ordersBoundary, "Orders Service") {

  Container(ordersService, "Orders Service", "NestJS")

  Component(orderController, "OrderController", "REST Controller", "Recebe requisições")
  Component(orderService, "OrderService", "Service", "Regras de negócio")
  Component(sagaOrchestrator, "SagaOrchestrator", "Service", "Coordena a SAGA")
  Component(eventPublisher, "EventPublisher", "Messaging", "Publica eventos")
  Component(eventHandler, "EventHandler", "Messaging", "Consome eventos")
  Component(orderRepository, "OrderRepository", "Repository", "Persistência")
}

ContainerDb(ordersDb, "Orders DB", "PostgreSQL")
Container(queue, "Message Broker", "RabbitMQ")

Rel(orderController, orderService, "Chama")
Rel(orderService, sagaOrchestrator, "Inicia fluxo")
Rel(sagaOrchestrator, eventPublisher, "Publica eventos")
Rel(queue, eventHandler, "Entrega eventos")
Rel(eventHandler, sagaOrchestrator, "Atualiza estado")
Rel(orderService, orderRepository, "Persistência")
Rel(orderRepository, ordersDb, "CRUD")
